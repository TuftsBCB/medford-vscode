{
    "scopeName": "source.mfd",
    "patterns": [
        {"include": "#metadata"},
        {"include": "#comment"},
        {"include": "#macro-def"}
    ],
    "repository": {
        "comment": {
            "patterns": [
                {
                    "name": "comment.line.number-sign",
                    "match": "#.*$"
                }
            ]
        },
        "metadata": {
            "patterns": [
                {
                    "begin": "(^@)\\b(Comment|Contributor|Data|Date|Expedetion|File|Funding|Keyword|MEDFORD|Method|Paper|Software|Species|Version|Data_Primary|Data_Copy|Data_Ref|Code_Primary|Code_Copy|Code_Ref|Paper_Primary|Paper_Copy|Paper_Ref)\\b(?:(-)\\b(\\S*))?\\b\\s*",
                    "end": "\\S?(?=^@|^`@|^#)",
                    "beginCaptures": {
                        "1": {"name": "keyword.control.metadata"},
                        "2": {"name": "constant.language.major-token"},
                        "3": {"name": "keyword.control.token-seperator"},
                        "4": {"name": "constant.language.minor-token"}
                    },
                    "contentName": "string.unquoted.text",
                    "patterns": [
                        {
                            "match": "(?<!^)(`@)([^{\\s]+)",
                            "captures": {
                                "1": {"name": "keyword.control.macro"},
                                "2": {"name": "support.variable.macro"}
                            }
                        },
                        {
                            "match": "(?<!^)(`@)({)([^}]+)(})",
                            "captures": {
                                "1": {"name": "keyword.control.macro"},
                                "2": {"name": "keyword.control.macro-brace"},
                                "3": {"name": "support.variable.macro"},
                                "4": {"name": "keyword.control.macro-brace"}
                            }
                        }
                    ]
                }
            ]
        },
        "macro-def": {
            "patterns": [
                {
                    "begin": "(^`@)([^{\\s]+)\\s*",
                    "end": "\\S?(?=^@|^`@|^#)",
                    "beginCaptures": {
                        "1": {"name": "keyword.control.macro"},
                        "2": {"name": "support.variable.macro"}
                    },
                    "contentName": "entity.name.macro-body"
                },
                {
                    "begin": "(^`@)({)([^}]+)(})\\s+",
                    "end": "\\S?(?=^@|^`@|^#)",
                    "beginCaptures": {
                        "1": {"name": "keyword.control.macro"},
                        "2": {"name": "keyword.control.macro-brace"},
                        "3": {"name": "support.variable.macro"},
                        "4": {"name": "keyword.control.macro-brace"}
                    },
                    "contentName": "entity.name.macro-body"
                }
            ]
        }
    }
}
